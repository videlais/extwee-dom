!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t.exports=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;r(this,t),this.name=e,this.tags=n,this.metadata=a,this.text=s,this.pid=o}},function(t,e,r){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r(5),s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name="Unknown",this.metadata={ifid:"",format:"",formatVersion:"",zoom:"",start:""},this.passages=[],this.creator=a.name,this.creatorVersion=a.version}var e,r,s;return e=t,(r=[{key:"getStylePassages",value:function(){var t=[];return this.passages.length>0&&(t=this.passages.filter((function(t){return t.tags.filter((function(t){return"stylesheet"==t})).length>0}))),t}},{key:"getScriptPassages",value:function(){var t=[];return this.passages.length>0&&(t=this.passages.filter((function(t){return t.tags.filter((function(t){return"script"==t})).length>0}))),t}},{key:"deleteAllByTag",value:function(t){this.passages.length>0&&(this.passages=this.passages.filter((function(e){return!e.tags.includes(t)})))}},{key:"getStartingPassage",value:function(){var t=null,e=null;if(this.metadata.hasOwnProperty("start")&&""!=this.metadata.start&&(e=this.metadata.start),this.passages.length>0)for(var r in this.passages){if(this.passages[r].name==e){t=this.passages[r].pid;break}"Start"==this.passages[r].name&&(t=this.passages[r].pid)}if(null==t)throw new Error("Starting passage not found!");return t}}])&&n(e.prototype,r),s&&n(e,s),t}();t.exports=s},function(t,e){function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}t.exports=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n,a;if(!("function"===(a=r(n=e))||"object"===a&&n))throw new Error("Expected JSON object!");this.name=e.name||null,this.version=e.version||null,this.description=e.description||null,this.author=e.author||null,this.image=e.image||null,this.url=e.url||null,this.license=e.license||null,this.proofing=e.proofing||null,this.source=e.source||null}},function(t,e,r){var n=r(4),a=r(6),s=r(1),o=r(0),i=r(2),l=r(7);window.extwee={TweeParser:n,StoryFormat:i,Passage:o,Story:s,HTMLParser:a,StoryFormatParser:l}},function(t,e,r){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r(0),s=r(1),o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.story=new s,this._passageMetadatError=!1,this._storydataError=!1,this.parse(e)}var e,r,o;return e=t,(r=[{key:"parse",value:function(t){var e=[];if(":"!=t[0]&&":"!=t[1]){var r=t.indexOf("::");t=t.slice(r,t.length)}var n=t.split("\n::");if(0==n)throw new Error("No passages were found!");n[0]=n[0].slice(2,n[0].length);var s=0,o=!0,i=!1,l=void 0;try{for(var u,f=n[Symbol.iterator]();!(o=(u=f.next()).done);o=!0){var c,h=u.value,p="",y="",g="",d=h.slice(0,h.indexOf("\n"));c=h.substring(d.length+1,h.length).trim();var v=d.lastIndexOf("{"),m=d.lastIndexOf("}");if(-1!=v&&-1!=m&&(y=d.slice(v,m+1),d=d.substring(0,v)+d.substring(m+1)),y.length>0)try{y=JSON.parse(y)}catch(t){this._passageMetadatError=!0}var w=d.lastIndexOf("["),b=d.lastIndexOf("]");if(-1!=w&&-1!=b&&(p=d.slice(w,b+1),d=d.substring(0,w)+d.substring(b+1)),p.length>0){p=p.substring(1,p.length-1);var S=[];if(""!=p&&(S=p.split(" ")),S.length>1){var x=[];for(var O in S)x.push(S[O].trim());p=x}else if(1==S.length){var E=p;(p=new Array).push(E)}else p=[]}else p=[];if(p=p.filter((function(t){return""!=t})),!((d=d.trim()).length>0))throw new Error("Malformed passage header!");g=d,this._passageMetadatError&&console.warn('Error parsing metadata for "'+g+'". It was ignored.'),e.push(new a(g,p,y,c,s)),s++}}catch(t){i=!0,l=t}finally{try{o||null==f.return||f.return()}finally{if(i)throw l}}var T=e.find((function(t){return"StoryTitle"==t.name}));if(null!=T?(this.story.name=T.text,e=e.filter((function(t){return"StoryTitle"!==t.name}))):this.story.name="Unknown",null!=(T=e.find((function(t){return"StoryData"==t.name})))){try{this.story.metadata=JSON.parse(T.text)}catch(t){this._storydataError=!0}e=e.filter((function(t){return"StoryData"!==t.name}))}this._storydataError&&console.warn("Error with processing StoryData JSON data. It was ignored."),this.story.passages=e}}])&&n(e.prototype,r),o&&n(e,o),t}();t.exports=o},function(t){t.exports=JSON.parse('{"name":"extwee-dom","version":"1.0.0"}')},function(t,e,r){"use strict";r.r(e);var n=r(1),a=r.n(n),s=r(0),o=r.n(s);function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.story=null,this.parse(e)}var e,r,n;return e=t,(r=[{key:"parse",value:function(t){var e=(new DOMParser).parseFromString(t,"text/html"),r=e.querySelector("tw-storydata");if(this.story=new a.a,null!=r){var n=r.attributes;this.story.name=n.name.nodeValue,this.story.creator=n.creator.nodeValue,this.story.creatorVersion=n["creator-version"].nodeValue,this.story.metadata={},this.story.metadata.ifid=n.ifid.nodeValue,this.story.metadata.format=n.format.nodeValue,this.story.metadata.formatVersion=n["format-version"].nodeValue,this.story.metadata.zoom=n.zoom.nodeValue,this.story.metadata.start=n.startnode.nodeValue}else this.reportError("Error: Not a Twine 2-style file!");var s=e.querySelectorAll("tw-passagedata");this.story.passages=[];var i=1;for(var l in this.story.passages.push(new o.a("StoryTitle",[],{},this.story.name,i)),i++,s){var u=s[l].attributes,f=s[l].innerText;if(void 0!==u){var c=u.position.nodeValue,h=u.size.nodeValue,p=u.name.nodeValue,y="";u.tags.nodeValue.length>0&&'""'!==u.tags.nodeValue&&(y=u.tags.nodeValue),y=(y=y.split(" ")).filter((function(t){return""!==t})),this.story.passages.push(new o.a(p,y,{position:c,size:h},f,i)),i++}}var g=e.querySelector("#twine-user-stylesheet");null!=g&&g.innerText.length>0&&this.story.passages.push(new o.a("UserStylesheet",["stylesheet"],{},g.innerText));var d=e.querySelector("#twine-user-script");null!=d&&d.innerText.length>0&&this.story.passages.push(new o.a("UserScript",["script"],{},d.innerText)),this.story.metadata.start=this.story.getStartingPassage().toString(),this.story.passages.push(new o.a("StoryData",[],{},JSON.stringify(this.story.metadata,null,4)))}},{key:"_escapeMetacharacters",value:function(t){return t=(t=(t=(t=(t=t.replace(/\\/g,"\\")).replace(/\\\{/g,"\\\\{")).replace(/\\\}/g,"\\\\}")).replace(/\\\[/g,"\\\\[")).replace(/\\\]/g,"\\\\]")}},{key:"reportError",value:function(t){document.querySelector("#twee").innerText=t}}])&&i(e.prototype,r),n&&i(e,n),t}();e.default=l},function(t,e,r){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=r(2),s=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storyformat=null,this.parse(e)}var e,r,s;return e=t,(r=[{key:"parse",value:function(t){if(-1!=t.indexOf("harlowe")){var e=t.lastIndexOf(',"setup": function');t=t.slice(0,e)+"}"}var r=t.indexOf("{"),n=t.lastIndexOf("}");if(-1==r||-1==n)throw new Error("Unable to find Twine2 JSON chunk!");t=t.slice(r,n+1);var s="";try{s=JSON.parse(t)}catch(t){throw new Error("Unable to parse Twine2 JSON chunk!")}this.storyformat=new a(s)}}])&&n(e.prototype,r),s&&n(e,s),t}();t.exports=s}]);